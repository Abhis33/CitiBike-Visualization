<!DOCTYPE html>
<html class="no-js">

<head>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

  <script src='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet' />

  <title>Whazzup</title>
</head>

<body>

  <div class="col-lg-12">
    <h1>My First Heading</h1>
    <p>My first paragraph.</p>
  </div>

  <!-- Chart js example start -->
  <div class="col-sm-4">
    <canvas id="myChart" width="400" height="300"></canvas>
  </div>
  <!-- Chart js example End -->

  <!-- Mapbox example start -->
  <div class="col-sm-8">
    <p>Simple Map</p>
    <div id='simple-map' style='width: 100%; height: 300px;'></div>
  </div>
  <!-- Mapbox example end -->

</body>

<script>
  {% block jquery %}

  var endpoint = '/api/subscriber_data'
  var defaultData = []
  var labels = []

  $.ajax({
    method: "GET",
    url: endpoint,
    success: function(data) {
      console.log(data)
      labels = data.subscriber_type
      defaultData = data.default
      setBarChart();
    },
    error: function(error_data) {
      console.log("Error")
      console.log(error_data)
    }
  })

  // Chart Js script start
  function setBarChart() {
    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: '# of Customer Type',
          data: defaultData,
          backgroundColor: [
            'rgba(255, 99, 132, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)',
            'rgba(255, 159, 64, 0.2)'
          ],
          borderColor: [
            'rgba(255, 99, 132, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true
            }
          }]
        }
      }
    });
  }
  // Chart Js script end

  // Mapbox script start
  mapboxgl.accessToken = 'pk.eyJ1Ijoic29naXBhIiwiYSI6ImNrOTR1dnEybjA1dG0zaGwyMnp0eXB0MzcifQ.lhRSsmYZBzQFDP61z6iPhQ';
  var map = new mapboxgl.Map({
  container: 'simple-map',
  style: 'mapbox://styles/mapbox/streets-v11',
  zoom: 11,
  center: [-73.9926947,40.740647]
  });

  map.on('load', function() {
  /* Sample feature from the `examples.8fgz4egr` tileset:
  {
  "type": "Feature",
  "properties": {
  "ethnicity": "White"
  },
  "geometry": {
  "type": "Point",
  "coordinates": [ -122.447303, 37.753574 ]
  }
  }
  */
  map.addSource('ethnicity', {
  type: 'vector',
  url: 'mapbox://examples.8fgz4egr'
  });
  map.addLayer({
  'id': 'population',
  'type': 'circle',
  'source': 'ethnicity',
  'source-layer': 'sf2010',
  'paint': {
  // make circles larger as the user zooms from z12 to z22
  'circle-radius': {
  'base': 1.75,
  'stops': [[12, 2], [22, 180]]
  },
  // color circles by ethnicity, using a match expression
  // https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-match
  'circle-color': [
  'match',
  ['get', 'ethnicity'],
  'White',
  '#fbb03b',
  'Black',
  '#223b53',
  'Hispanic',
  '#e55e5e',
  'Asian',
  '#3bb2d0',
  /* other */ '#ccc'
  ]
  }
  });
  });
  // Mapbox script end
  
  {% endblock %}
</script>

</html>
